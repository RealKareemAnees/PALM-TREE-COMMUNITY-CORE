{
  "version": 3,
  "sources": ["../../controllers/streamFile.ts"],
  "sourcesContent": ["import * as tcp from \"net\";\nimport { open } from \"fs/promises\";\n\n/**\n *\n * @param {tcp.Socket} socket\n * @param {string} path\n * @description no description, just read the fucken STRONGLY TYPED TS CODE\n * @author zeft\n */\nasync function streamFile(socket: tcp.Socket, path: string) {\n  try {\n    const fileHandle = await open(path, \"r\");\n    const fileStream = fileHandle.createReadStream();\n\n    fileStream.on(\"data\", (chunk) => {\n      if (!socket.write(chunk)) {\n        fileStream.pause();\n      }\n    });\n    socket.on(\"drain\", () => {\n      fileStream.resume();\n    });\n\n    fileStream.on(\"end\", async () => {\n      try {\n        await fileHandle.close();\n        socket.end();\n      } catch (error) {\n        socket.end();\n        throw new Error(error);\n      }\n    });\n\n    socket.on(\"close\", () => {\n      console.log(\"Socket closed\");\n      if (!fileStream.closed) {\n        fileStream.close();\n      }\n    });\n\n    socket.on(\"end\", () => {\n      console.log(\"Connection to client closed\");\n      if (!socket.destroyed && !fileStream.closed) {\n        fileStream.close();\n      }\n    });\n    socket.on(\"error\", (error) => {\n      if (!fileStream.closed) {\n        fileStream.close();\n      }\n      const stringifiedErrorBecauseThisFuckenTypeScriptJustSucks =\n        error.toString();\n      throw new Error(stringifiedErrorBecauseThisFuckenTypeScriptJustSucks);\n    });\n  } catch (error) {\n    throw new Error(error);\n  }\n}\n\nexport { streamFile };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,sBAAqB;AASrB,eAAe,WAAW,QAAoB,MAAc;AAC1D,MAAI;AACF,UAAM,aAAa,UAAM,sBAAK,MAAM,GAAG;AACvC,UAAM,aAAa,WAAW,iBAAiB;AAE/C,eAAW,GAAG,QAAQ,CAAC,UAAU;AAC/B,UAAI,CAAC,OAAO,MAAM,KAAK,GAAG;AACxB,mBAAW,MAAM;AAAA,MACnB;AAAA,IACF,CAAC;AACD,WAAO,GAAG,SAAS,MAAM;AACvB,iBAAW,OAAO;AAAA,IACpB,CAAC;AAED,eAAW,GAAG,OAAO,YAAY;AAC/B,UAAI;AACF,cAAM,WAAW,MAAM;AACvB,eAAO,IAAI;AAAA,MACb,SAAS,OAAO;AACd,eAAO,IAAI;AACX,cAAM,IAAI,MAAM,KAAK;AAAA,MACvB;AAAA,IACF,CAAC;AAED,WAAO,GAAG,SAAS,MAAM;AACvB,cAAQ,IAAI,eAAe;AAC3B,UAAI,CAAC,WAAW,QAAQ;AACtB,mBAAW,MAAM;AAAA,MACnB;AAAA,IACF,CAAC;AAED,WAAO,GAAG,OAAO,MAAM;AACrB,cAAQ,IAAI,6BAA6B;AACzC,UAAI,CAAC,OAAO,aAAa,CAAC,WAAW,QAAQ;AAC3C,mBAAW,MAAM;AAAA,MACnB;AAAA,IACF,CAAC;AACD,WAAO,GAAG,SAAS,CAAC,UAAU;AAC5B,UAAI,CAAC,WAAW,QAAQ;AACtB,mBAAW,MAAM;AAAA,MACnB;AACA,YAAM,uDACJ,MAAM,SAAS;AACjB,YAAM,IAAI,MAAM,oDAAoD;AAAA,IACtE,CAAC;AAAA,EACH,SAAS,OAAO;AACd,UAAM,IAAI,MAAM,KAAK;AAAA,EACvB;AACF;",
  "names": []
}
